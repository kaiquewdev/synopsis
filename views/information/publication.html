{{ extend 'layout.html' }}

<div class="content">
	<section>
		<article>
			{{for detail in publication: }}
			<header>
				{{=A( T('Go to publications'), _href=URL('profile', args=[session.index]) )}} |
				{{=A( T('Insert a quote'), _href=URL('profile', args=['quote', request.args[0]]) )}} |
				{{=A(T('Insert a new column'), _href=URL('new', args=['column', request.args[0]]) )}}
				<hr />
				<h1>{{=detail.title}}</h1>
				<h4 style="font-weight: 200;">{{if detail.sub_title:}} {{=detail.sub_title}} {{pass}}</h4>
				<hr />
			</header>
			<div>	
				<table style="border: 1px solid #ccc; margin: 10px 0 10px;">
					<thead>
						<tr>
							{{for column in detail.column.select():}}
								<td>{{=A(column.title, _href=URL('new', args=['row', column.id]))}}</td>
							{{pass}}							
						</tr>
					</thead>
					<tbody>
						{{ lines = {} }}
						
						{{for column in detail.column.select():}}
							{{lines[column.id] = TR()}}
						{{pass}}
						
						{{for column in detail.column.select():}}
							{{for row in column.row.select(orderby='created_on'):}}
								{{lines[row.column_id].append(TD(row.content))}}
							{{pass}}
						{{pass}}

						{{for l in lines:}}
							{{=lines[l]}}
						{{pass}}						
					</tbody>
				</table>
				<div classs="quote">
				{{for quote in detail.quote.select():}}
					<p>{{=quote.content}}</p>
				{{pass}}
				</div>
			</div>
			{{pass}}
		</article>
	</section>
</div>
